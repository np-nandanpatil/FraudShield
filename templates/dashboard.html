<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment Gateway Dashboard</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.css">
    <style>
        body { font-family: Arial, sans-serif; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .card { margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header { background-color: #007bff; color: white; padding: 20px; margin-bottom: 30px; border-radius: 5px; }
        .stat-card { text-align: center; padding: 20px; }
        .stat-value { font-size: 2rem; font-weight: bold; }
        .fraud { color: #dc3545; }
        .legitimate { color: #28a745; }
        .table-responsive { margin-top: 20px; }
        .chart-container { height: 300px; margin-bottom: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="text-center">Payment Gateway Dashboard</h1>
            <p class="text-center">Fraud Detection Statistics and Transaction History</p>
        </div>
        
        <div class="row">
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="card-body">
                        <h5 class="card-title">Total Transactions</h5>
                        <div class="stat-value" id="total-transactions">0</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="card-body">
                        <h5 class="card-title">Fraud Detected</h5>
                        <div class="stat-value fraud" id="fraud-count">0</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="card-body">
                        <h5 class="card-title">Legitimate</h5>
                        <div class="stat-value legitimate" id="legitimate-count">0</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="card-body">
                        <h5 class="card-title">Fraud Rate</h5>
                        <div class="stat-value" id="fraud-rate">0%</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Fraud Types Distribution
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="fraud-types-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Transaction Volume
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="transaction-volume-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                Recent Transactions
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Transaction ID</th>
                                <th>Timestamp</th>
                                <th>Amount</th>
                                <th>Sender</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Fraud Score</th>
                                <th>Fraud Type</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-table">
                            <!-- Transactions will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-4">
            <a href="/" class="btn btn-primary">Back to Payment Gateway</a>
        </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <script>
        $(document).ready(function() {
            // Fetch transaction data
            $.getJSON('/api/transactions', function(data) {
                populateTransactionTable(data);
            });
            
            // Fetch fraud statistics
            $.getJSON('/api/fraud_stats', function(data) {
                updateDashboardStats(data);
                createFraudTypesChart(data.fraud_types);
            });
        });
        
        function populateTransactionTable(transactions) {
            const tableBody = $('#transactions-table');
            tableBody.empty();
            
            transactions.slice(0, 20).forEach(function(txn) {
                const row = $('<tr>');
                const isFraud = txn.Is_Fraud === 'True';
                
                row.append($('<td>').text(txn.Transaction_ID));
                row.append($('<td>').text(new Date(txn.Timestamp).toLocaleString()));
                row.append($('<td>').text('â‚¹' + parseFloat(txn.Amount).toFixed(2)));
                row.append($('<td>').text(txn.Sender_ID));
                row.append($('<td>').text(txn.Transaction_Type));
                
                const statusCell = $('<td>');
                if (txn.Status === 'COMPLETED') {
                    statusCell.html('<span class="badge badge-success">Completed</span>');
                } else if (txn.Status === 'BLOCKED') {
                    statusCell.html('<span class="badge badge-danger">Blocked</span>');
                } else {
                    statusCell.html('<span class="badge badge-warning">Pending</span>');
                }
                row.append(statusCell);
                
                const scoreCell = $('<td>');
                const score = parseFloat(txn.Fraud_Probability);
                if (score > 0.7) {
                    scoreCell.html(`<span class="text-danger">${(score*100).toFixed(2)}%</span>`);
                } else if (score > 0.3) {
                    scoreCell.html(`<span class="text-warning">${(score*100).toFixed(2)}%</span>`);
                } else {
                    scoreCell.html(`<span class="text-success">${(score*100).toFixed(2)}%</span>`);
                }
                row.append(scoreCell);
                
                row.append($('<td>').text(isFraud ? txn.Fraud_Type : '-'));
                
                tableBody.append(row);
            });
        }
        
        function updateDashboardStats(stats) {
            $('#total-transactions').text(stats.total_transactions);
            $('#fraud-count').text(stats.fraud_count);
            $('#legitimate-count').text(stats.total_transactions - stats.fraud_count);
            $('#fraud-rate').text(stats.fraud_percentage + '%');
        }
        
        function createFraudTypesChart(fraudTypes) {
            const labels = Object.keys(fraudTypes);
            const data = Object.values(fraudTypes);
            
            const ctx = document.getElementById('fraud-types-chart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#dc3545', '#fd7e14', '#ffc107', '#28a745', '#20c997',
                            '#17a2b8', '#007bff', '#6c757d', '#6f42c1', '#e83e8c'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: {
                        position: 'right'
                    }
                }
            });
            
            // Simple transaction volume chart
            const volumeCtx = document.getElementById('transaction-volume-chart').getContext('2d');
            new Chart(volumeCtx, {
                type: 'bar',
                data: {
                    labels: ['Card', 'UPI', 'Net Banking', 'Wallet'],
                    datasets: [{
                        label: 'Transaction Volume',
                        data: [
                            Math.floor(Math.random() * 50) + 30,
                            Math.floor(Math.random() * 50) + 40,
                            Math.floor(Math.random() * 30) + 20,
                            Math.floor(Math.random() * 20) + 10
                        ],
                        backgroundColor: ['#007bff', '#28a745', '#ffc107', '#17a2b8']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });
        }
    </script>
</body>
</html> 