<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SynthHack Payment Gateway</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body { font-family: Arial, sans-serif; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .transaction { margin-bottom: 20px; }
        .fraud-alert { color: red; font-weight: bold; }
        .success-alert { color: green; font-weight: bold; }
        .header { background-color: #007bff; color: white; padding: 20px; margin-bottom: 30px; border-radius: 5px; }
        .result-card { border: 1px solid #ddd; border-radius: 5px; padding: 15px; margin-top: 20px; }
        .payment-methods { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .payment-method { cursor: pointer; padding: 15px; border: 1px solid #ddd; border-radius: 5px; flex: 1; margin: 0 5px; text-align: center; transition: all 0.3s; }
        .payment-method:hover { border-color: #007bff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .payment-method.active { border-color: #007bff; background-color: #f0f7ff; }
        .payment-method img { height: 30px; margin-bottom: 10px; }
        .security-badge { display: inline-block; background-color: #f8f9fa; border-radius: 20px; padding: 5px 10px; margin: 5px; font-size: 12px; }
        .security-badge i { margin-right: 5px; color: #28a745; }
        .fraud-meter { height: 8px; background-color: #eee; border-radius: 4px; margin-top: 10px; overflow: hidden; }
        .fraud-meter-fill { height: 100%; background: linear-gradient(to right, #28a745, #ffc107, #dc3545); width: 0%; transition: width 0.5s; }
        .order-summary { background-color: #f8f9fa; border-radius: 5px; padding: 15px; margin-top: 20px; }
        .saved-cards { margin-bottom: 20px; }
        .saved-card { padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px; cursor: pointer; }
        .saved-card:hover { border-color: #007bff; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="text-center">SynthHack Payment Gateway</h1>
            <p class="text-center">Secure Payments with Real-time Fraud Detection</p>
            <div class="text-center mt-3">
                <span class="security-badge"><i class="fas fa-shield-alt"></i> PCI DSS Compliant</span>
                <span class="security-badge"><i class="fas fa-lock"></i> 256-bit Encryption</span>
                <span class="security-badge"><i class="fas fa-fingerprint"></i> AI Fraud Detection</span>
                <span class="security-badge"><i class="fas fa-check-circle"></i> 3D Secure 2.0</span>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Choose Payment Method</h4>
            </div>
            <div class="card-body">
                <div class="payment-methods">
                    <div class="payment-method active" data-method="card">
                        <img src="https://via.placeholder.com/60x30?text=Card" alt="Credit/Debit Card">
                        <div>Card</div>
                    </div>
                    <div class="payment-method" data-method="upi">
                        <img src="https://via.placeholder.com/60x30?text=UPI" alt="UPI">
                        <div>UPI</div>
                    </div>
                    <div class="payment-method" data-method="netbanking">
                        <img src="https://via.placeholder.com/60x30?text=NetBanking" alt="Net Banking">
                        <div>Net Banking</div>
                    </div>
                    <div class="payment-method" data-method="wallet">
                        <img src="https://via.placeholder.com/60x30?text=Wallet" alt="Wallet">
                        <div>Wallet</div>
                    </div>
                </div>
                
                <div class="order-summary">
                    <h5>Order Summary</h5>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Product:</span>
                        <span>Demo Product</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Merchant:</span>
                        <span>SynthHack Demo Store</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Order ID:</span>
                        <span>ORD-<script>document.write(Math.floor(Math.random()*900000)+100000)</script></span>
                    </div>
                    <div class="d-flex justify-content-between font-weight-bold">
                        <span>Amount:</span>
                        <span>₹2,500.00</span>
                    </div>
                </div>
                
                <div id="payment-forms">
                    <!-- Credit/Debit Card Form -->
                    <div id="card-form" class="payment-form">
                        <h5 class="mt-4 mb-3">Credit/Debit Card</h5>
                        
                        <div class="saved-cards">
                            <h6>Saved Cards</h6>
                            <div class="saved-card">
                                <div class="d-flex justify-content-between">
                                    <span><i class="far fa-credit-card"></i> XXXX XXXX XXXX 4242</span>
                                    <span>Expires: 12/25</span>
                                </div>
                            </div>
                            <div class="saved-card">
                                <div class="d-flex justify-content-between">
                                    <span><i class="far fa-credit-card"></i> XXXX XXXX XXXX 5678</span>
                                    <span>Expires: 08/24</span>
                                </div>
                            </div>
                        </div>
                        
                        <form id="cardForm">
                            <div class="transaction">
                                <label for="cardNumber">Card Number:</label>
                                <input type="text" id="cardNumber" class="form-control" required placeholder="XXXX XXXX XXXX XXXX">
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="transaction">
                                        <label for="expiry">Expiry Date:</label>
                                        <input type="text" id="expiry" class="form-control" placeholder="MM/YY" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="transaction">
                                        <label for="cvv">CVV:</label>
                                        <input type="text" id="cvv" class="form-control" required placeholder="XXX">
                                    </div>
                                </div>
                            </div>
                            <div class="transaction">
                                <label for="cardHolder">Card Holder Name:</label>
                                <input type="text" id="cardHolder" class="form-control" required placeholder="JOHN DOE">
                            </div>
                            <div class="transaction">
                                <label for="saveCard">
                                    <input type="checkbox" id="saveCard"> Save card for future payments
                                </label>
                            </div>
                            <div class="fraud-detection-info">
                                <h6>Fraud Detection Status:</h6>
                                <div class="fraud-meter">
                                    <div class="fraud-meter-fill" id="fraud-meter"></div>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <small>Low Risk</small>
                                    <small>Medium Risk</small>
                                    <small>High Risk</small>
                                </div>
                                <p class="mt-2 mb-0"><small>Our AI is constantly analyzing this transaction for fraud patterns.</small></p>
                            </div>
                            <button type="submit" class="btn btn-primary btn-block mt-3">Pay ₹2,500.00</button>
                        </form>
                    </div>
                    
                    <!-- UPI Form -->
                    <div id="upi-form" class="payment-form" style="display: none;">
                        <h5 class="mt-4 mb-3">UPI Payment</h5>
                        <form id="upiForm">
                            <div class="transaction">
                                <label for="upiId">UPI ID:</label>
                                <input type="text" id="upiId" class="form-control" required placeholder="example@upi">
                            </div>
                            <div class="fraud-detection-info">
                                <h6>Fraud Detection Status:</h6>
                                <div class="fraud-meter">
                                    <div class="fraud-meter-fill" id="fraud-meter-upi"></div>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <small>Low Risk</small>
                                    <small>Medium Risk</small>
                                    <small>High Risk</small>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary btn-block mt-3">Pay ₹2,500.00</button>
                        </form>
                    </div>
                    
                    <!-- Other forms would be defined here -->
                </div>
            </div>
            <div class="card-footer">
                <div class="text-center">
                    <img src="https://via.placeholder.com/400x30?text=Secured+By+SynthHack+Fraud+Detection" alt="Security Badges">
                </div>
            </div>
        </div>
        
        <div id="result" class="result-card mt-4" style="display: none;">
            <h4 id="resultTitle"></h4>
            <div id="resultDetails"></div>
        </div>
        
        <div class="text-center mt-4">
            <a href="/dashboard" class="btn btn-outline-primary">View Transaction History</a>
        </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        function isValidCardNumber(number) {
            // Remove spaces and non-numeric characters
            number = number.replace(/\D/g, '');
            if (number.length !== 16) return false;
            
            // Luhn Algorithm for card number validation
            let sum = 0;
            let shouldDouble = false;
            for (let i = number.length - 1; i >= 0; i--) {
                let digit = parseInt(number.charAt(i));
                if (shouldDouble) {
                    digit *= 2;
                    if (digit > 9) digit -= 9;
                }
                sum += digit;
                shouldDouble = !shouldDouble;
            }
            return sum % 10 === 0;
        }

        function isValidCVV(cvv) {
            return /^\d{3}$/.test(cvv);
        }

        function isValidExpiryDate(expiry) {
            if (!/^\d{2}\/\d{2}$/.test(expiry)) return false;
            
            const [month, year] = expiry.split('/').map(Number);
            if (month < 1 || month > 12) return false;
            
            const now = new Date();
            const currentYear = now.getFullYear() % 100;
            const currentMonth = now.getMonth() + 1;
            
            if (year < currentYear) return false;
            if (year === currentYear && month < currentMonth) return false;
            
            return true;
        }

        function isValidUPIId(upiId) {
            // Simple regex for UPI ID format validation
            return /^[\w.-]+@[\w.-]+$/.test(upiId);
        }
        
        function getDeviceId() {
            // Simple device ID generation
            if (localStorage.getItem('deviceId')) {
                return localStorage.getItem('deviceId');
            }
            const deviceId = 'Device_' + Math.floor(Math.random() * 9000 + 1000);
            localStorage.setItem('deviceId', deviceId);
            return deviceId;
        }
        
        function getLocation() {
            // Simulated location data
            return '12.9716, 77.5946'; // Default to Bangalore coordinates
        }

        function showResult(data, isError) {
            const resultElement = document.getElementById('result');
            const resultTitle = document.getElementById('resultTitle');
            const resultDetails = document.getElementById('resultDetails');
            
            resultElement.style.display = 'block';
            resultElement.className = isError ? 
                'result-card mt-4 alert alert-danger' : 
                'result-card mt-4 alert alert-success';
            
            if (isError) {
                resultTitle.textContent = 'Transaction Blocked';
                resultDetails.innerHTML = `
                    <p><strong>Reason:</strong> ${data.reason}</p>
                    <p><strong>Confidence:</strong> ${(data.confidence * 100).toFixed(2)}%</p>
                    <p>Our fraud detection system has flagged this transaction. Please try a different payment method or contact your bank.</p>
                `;
            } else if (data.status === 'pending_verification') {
                resultTitle.textContent = 'Verification Required';
                resultDetails.innerHTML = `
                    <p>Your transaction requires additional verification.</p>
                    <p>You will be redirected to the verification page.</p>
                    <div class="text-center">
                        <a href="${data.redirect_url}" class="btn btn-primary">Proceed to Verification</a>
                    </div>
                `;
            } else {
                resultTitle.textContent = 'Transaction Approved';
                resultDetails.innerHTML = `
                    <p><strong>Status:</strong> Payment Successful</p>
                    <p><strong>Confidence:</strong> ${(data.confidence * 100).toFixed(2)}%</p>
                    <p>Your transaction has been processed successfully. Thank you for using our payment gateway!</p>
                `;
            }
        }
        
        // Simulate real-time fraud detection
        function updateFraudMeter() {
            // For card form
            const cardNumber = $('#cardNumber').val() || '';
            const cvv = $('#cvv').val() || '';
            const expiry = $('#expiry').val() || '';
            
            let riskScore = 0;
            
            // Card number validation
            if (cardNumber.length > 0) {
                if (cardNumber.includes('4242')) riskScore += 10;
                if (cardNumber.length < 16 || cardNumber.length > 19) riskScore += 20;
                if (cardNumber.match(/(\d)\1{5,}/)) riskScore += 30; // Repeated digits
            }
            
            // CVV validation
            if (cvv.length > 0) {
                if (cvv === '123' || cvv === '000') riskScore += 15;
            }
            
            // Expiry validation
            if (expiry.length > 0) {
                const [month, year] = expiry.split('/').map(Number);
                if (year < new Date().getFullYear() % 100) riskScore += 25;
            }
            
            // Amount is also a factor
            if (2500 > 5000) riskScore += 20;
            
            // Cap the risk score at 100
            riskScore = Math.min(riskScore, 100);
            
            // Update the fraud meter
            $('#fraud-meter').css('width', riskScore + '%');
            
            // Similar logic for UPI
            const upiId = $('#upiId').val() || '';
            let upiRiskScore = 0;
            
            if (upiId.length > 0) {
                if (!upiId.includes('@')) upiRiskScore += 30;
                if (upiId.includes('suspicious')) upiRiskScore += 50;
            }
            
            // Amount is also a factor
            if (2500 > 5000) upiRiskScore += 20;
            
            // Cap the risk score
            upiRiskScore = Math.min(upiRiskScore, 100);
            
            // Update the UPI fraud meter
            $('#fraud-meter-upi').css('width', upiRiskScore + '%');
        }
        
        $(document).ready(function() {
            // Payment method selection
            $('.payment-method').click(function() {
                $('.payment-method').removeClass('active');
                $(this).addClass('active');
                
                const method = $(this).data('method');
                $('.payment-form').hide();
                $(`#${method}-form`).show();
            });
            
            // Fraud meter updates
            $('input').on('input', updateFraudMeter);
            
            // Update initially
            updateFraudMeter();
            
            // Card form submission
            $('#cardForm').on('submit', function(event) {
                event.preventDefault();
                const cardNumber = $('#cardNumber').val().replace(/\s+/g, '');
                const cvv = $('#cvv').val();
                const expiry = $('#expiry').val();
                const cardHolder = $('#cardHolder').val();

                if (!isValidCardNumber(cardNumber)) {
                    alert('Invalid card number. Please check and try again.');
                    return;
                }
                if (!isValidCVV(cvv)) {
                    alert('Invalid CVV. Must be 3 digits.');
                    return;
                }
                if (!isValidExpiryDate(expiry)) {
                    alert('Invalid expiry date. Use MM/YY format and ensure date is in the future.');
                    return;
                }

                const data = {
                    Transaction_ID: 'CARD_' + Date.now(),
                    Timestamp: new Date().toISOString(),
                    Amount: 2500.00,
                    Sender_ID: cardNumber.substring(0, 6) + '******' + cardNumber.substring(12),
                    Receiver_ID: 'Merchant_SynthHack',
                    Transaction_Type: 'Card',
                    Merchant_Type: 'Online',
                    Device_ID: getDeviceId(),
                    Location: getLocation()
                };
                
                processTransaction(data);
            });
            
            // UPI form submission
            $('#upiForm').on('submit', function(event) {
                event.preventDefault();
                const upiId = $('#upiId').val();
                
                if (!isValidUPIId(upiId)) {
                    alert('Invalid UPI ID format. Please use format like name@upi');
                    return;
                }
                
                const data = {
                    Transaction_ID: 'UPI_' + Date.now(),
                    Timestamp: new Date().toISOString(),
                    Amount: 2500.00,
                    Sender_ID: upiId,
                    Receiver_ID: 'SynthHack@upi',
                    Transaction_Type: 'UPI',
                    Merchant_Type: 'Online',
                    Device_ID: getDeviceId(),
                    Location: getLocation()
                };
                
                processTransaction(data);
            });
        });

        function processTransaction(data) {
            // Show loading indicator
            document.getElementById('result').style.display = 'block';
            document.getElementById('result').className = 'result-card mt-4 alert alert-info';
            document.getElementById('resultTitle').textContent = 'Processing Transaction...';
            document.getElementById('resultDetails').innerHTML = `
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                    <p class="mt-3">Please wait while we process your payment and analyze for potential fraud...</p>
                </div>
            `;
            
            fetch('/process_transaction', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => {
                const isError = !response.ok;
                return response.json().then(data => ({ data, isError }));
            })
            .then(({ data, isError }) => {
                showResult(data, isError);
            })
            .catch(error => {
                document.getElementById('result').className = 'result-card mt-4 alert alert-danger';
                document.getElementById('resultTitle').textContent = 'Error';
                document.getElementById('resultDetails').innerHTML = `<p>An error occurred: ${error.message}</p>`;
            });
        }
    </script>
</body>
</html> 